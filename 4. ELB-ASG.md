# 1. Elastic Load Balancer(ELB)
 ## * Scalability 
 Scalability means that your application system can hinder a greater load by adapting. And so, there are two kind of scalability.

  1. **Vertical scalability**  
  that means that you need to increase the size of your instance.

      So, let's take a phone operator, for example. We have a junior operator and we just hired him.  He's great but he can only take five calls per minute. Now, we have a senior operator and he's much greater. He can take up to ten calls per minute. So, we've basically scaled up our junior operator into senior operator and he's faster and better. ![Vertical-scalibility](/images/VERTiCAL-SCALE.png "VS")

      So, for example, in EC2, our application runs on a a t2.micro and we want to upscale that application,that means we want to run it on a t2.large

      So, when do we use vertical scalability?
      Well, it's very common when you have non distributed system, such as a data base.
      So, it's quite common for a data base, for example, on RDS or ElastiCache, these are services that you can just scale vertically by upgrading the underlying instance type, although, there usually are limits to how much you can vertically scale and that's a hardware limit but still, vertical scalability is fine for a lot of use cases.

  2.  **Horizontal scalability, also called elasticity.**  
      Horizontal scalability means that you increases the number of instances/systems for your application.

      So, let's take again, our call center. We have an operator and he is being overloaded. I don't want to vertically scale it, I want to hire a second operator and now, I've just doubled my capacity. Actually, I'll hire a third operator. ![Vertical-scalibility](/images/HORINTAL-SCALE.png "VS")

  3.  **High Availibility**   
    High availability, that means that you're running your application or system in at least two data centers, or two availability zones in AWS. And he goal of high availability is to be able to survive a data center loss, so in case one center goes down, then we're still running. ![Highly-availibity](/images/HIGHLY-AVAILABLE.png "HA")

## * Elastic Load Balancing(ELB)
 Load balancers are servers that will forward internet traffic to your multiple backhand EC2 Instances.
![ELB](/images/ELASTIC-LOAD-BALANCING.png "ELB")
### Why use a load balancer?
  * Spread load across multiple downstream instances 
  * Expose a single point of access (DNS) to your application 
  * Seamlessly handle failures of downstream instances 
  * Do regular health checks to your instances 
  * Provide SSL termination (HTTPS) for your websites 
  * Enforce stickiness with cookies 
  * High availability across zones 
  * Separate public traffic from private traffic
### Why use an EC2 Load Balancer?
  * An ELB (EC2 Load Balancer) is a managed load balancer
    * AWS guarantees that it will be working
    * AWS takes care of upgrades, maintenance, high availability
    * AWS provides only a few configuration knobs
  * It costs less to setup your own load balancer but it will be a lot more effort on your end. 
  * It is integrated with many AWS offerings / services
### Health Checks
  * Health Checks are crucial for Load Balancers
  * They enable the load balancer to know if instances it forwards traffic to are available to reply to requests
  * The health check is done on a port and a route (/health is common)
  * If the response is not 200 (OK), then the instance is unhealthy
### Health Checks
AWS has **3** kinds of managed Load Balancers
* Classic Load Balancer (v1 - old generation) – 2009
  * Supports HTTP, HTTPS, TCP
* Application Load Balancer (v2 - new generation) – 2016
  * Supports HTTP, HTTPS, WebSocket to
*  Network Load Balancer (v2 - new generation) – 2017
   * Supports TCP, TLS (secure TCP) & UDP to
* Overall, it is recommended to use the newer / v2 generation load balancers as they provide more features 
* If the LB can’t connect to your application, check your security groups!
* Load Balancer Errors 503 means at capacity or no registered target
### Load Balancer Security Groups
the more interesting part is between the load balancers and your EC2 instance. So, there is going to be HTTP traffic between these two because your load balancer has to talk to your EC2 instances through HTTP, but this time, we want that traffic to be strictly restricted to your load balancer. What that means is that your EC2 instance expects only your load balancer to send traffic to it. And as such, we can have an application security group which allows only traffic from the load balancer. And so here, the interesting this is that it says, okay, HTTP on Port 80, the source of which is a security group, you see there is a long security group with an ID.
And, that security group ID represents the load balancer security group ID. So, the load balancer here has a security group. Your EC2 instance has a security group. The EC2 instance security group references the one
from the load balancer, which is right here, and the line from the load balancer has the rules which allows the users to access from anywhere on HTTP and HTTPS. That is the most secure one
![ELB-SC](/images/LOAD_BALANCER-SECURITY_GROUPS.png "ELB-SC")

## 1. Classic Load Balancer(ELB)
So they support two things, the TCP or traffic or HTTP and HTTPS. So the health checks are either TCP based or HTTP based. 
What we are going to
* create Load Balancer -> choose Classic Load balancer and just give the name
* then create new security group will lead Load balancer. if you want just your load balacer talk instance you need to create Security group and that SC will restrict EC2 just speak load balancer.
* then we are going to create health check. and we are going to play maybe on threshold=5, ping path =/
* and then we are going to choose an instance 
* then next and create it.
* so if you go description and copy DNS name and go to browser you should see same result with ip call
* so here the problem we just wanted our load balancer access our EC2 lets solve that
* the problem you need to check your security-groups and find inbound http just come from load-balancer's security group
* so here we can create more instances and assign our Classic load balancer and then load balancer will spread traffic on instances. when you see status inService then it works
* then lets delete clb
## 2. Application Load Balancer(ELB)
* Application load balancers is Layer 7 (HTTP)
* Load balancing to multiple HTTP applications across machines (target groups)
* Load balancing to multiple applications on the same machine (ex: containers)
* Support for HTTP/2 and WebSocket
* Support redirects (from HTTP to HTTPS for example)
* Routing tables to different target groups
  * Routing based on path in URL (example.com/users & example.com/posts)
  * Routing based on hostname in URL (one.example.com & other.example.com)
  * Routing based on Query String, Headers (example.com/users?id=123&order=false)
* ALB are a great fit for micro services & container-based application (example: Docker & Amazon ECS) 
* Has a port mapping feature to redirect to a dynamic port in ECS
* In comparison, we’d need multiple Classic Load Balancer per application
 ![APPL-LB](/images/APPL-LOAD-BALANCER.png "APPL-LB")
* EC2 instances (can be managed by an Auto Scaling Group) – HTTP 
* Lambda functions – HTTP request is translated into a JSON event
* IP Addresses – must be private IPs
* ALB can route to multiple target groups
* Health checks are at the target group level
* The application servers don’t see the IP of the client directly
  * The true IP of the client is inserted in the header X-Forwarded-For
  * We can also get Port (X-Forwarded-Port) and proto (X-Forwarded-Proto)
* so we are going to create ALB from Load Balancers
* choose your Availibility zones and continue 
* and choose your security group 
* and choose your target-group under the routing tab and choose instance and here you go
* then after ALB be active you will get 503 error
* because we didnt register and instnace to target-group
* in the left menu after load-balancers you will see Target-Groups 
* and go there choose your target groups andtry to add instance
* and now when you go your dns address it will work
* now we are going to do path forwarded to EC2 instances
* so if we click /user will go x instance /product will go y instance /order will go z instance
* for that we are going to create new target-groups
* after that goto load-balancer listeners tab and view-edit rules
* and click add new choose path /orders and forward to orders-target-group
* or you can create other rules example /groups forwreturn fix response 404 not found
* 
